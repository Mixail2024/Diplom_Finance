{% extends 'layout/basic.html' %}
{% load static %}

{% block title %} Wallets {% endblock %}

{% block menu %}{% endblock %}

{% block extra_head %}
     <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var data1 = google.visualization.arrayToDataTable({{ data_chart1|safe }});
            var options = {
                title: 'My 3D Pie Chart',
                is3D: true,
                backgroundColor: { fill: 'transparent' },
                slices: {
                    0: {offset: 0.1},         // Сдвиг первого сегмента
                    1: {offset: 0.1},         // Сдвиг второго сегмента
                },
                chartArea: {
                    left: 20,
                    top: 20,
                    width: '90%',
                    height: '80%'
                },
                pieSliceText: 'value',        // Отображение значений на диаграмме
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(data1, options);
        }
     </script>
{% endblock %}

{% block header %}

        <div>
            <div class='nav_H'>
                <div class="wallet">Wallets</div>
                <button class="btn btn_add_wlt" onclick="location.href='{% url 'create_wlt' %}'">Add</button>
            </div>

            <form method='POST'>
            {% csrf_token %}
                <label>Period from</label> {{ form.init_date }}
                {% if form.date.errors %}
                    <div style="color: red;">{{ form.init_date.errors }}</div>
                {% endif %}
                <label>to</label> {{ form.final_date }}
                {% if form.date.errors %}
                    <div style="color: red;">{{ form.final_date.errors }}</div>
                {% endif %}


                 <!-- Подключение Flatpickr -->
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
                <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        flatpickr("#datepicker", {
                            dateFormat: "Y-m-d",
                        });
                    });
                </script>
                <button class='btn nav_btn' type='submit' >Set</button>
            </form>
        </div>

{% endblock %}

{% block left_side %}
    {% for ticker, wallets in data.items %}
        <p>{{ ticker }}</p>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Wallet</th>
                    <th>Initial <br> balance</th>
                    <th>Income</th>
                    <th>Spending</th>
                    <th>Final <br> balance</th>
                </tr>
            </thead>
            <tbody>
                {% for wallet, wallet_data in wallets.items %}
                    <tr>
                        <td>{{ wallet_data.n }}</td> <!-- Порядковый номер -->
                        <td style="font-weight: bold;">
                            <a href="{% url 'home_wlt' wallet_data.wlt_pk %}calendar/?choice=period&start_date={{info_init|date:'Y-m-d'}}&end_date={{info_final|date:'Y-m-d'}}">{{ wallet.f_name }}</a>
                        </td>
                        <td style="text-align: right;">{{ wallet_data.bal_on_date|floatformat:2 }}</td>
                        <td style="text-align: right;">{{ wallet_data.after_dt_sum|floatformat:2 }}</td>
                        <td style="text-align: right;">{{ wallet_data.after_ct_sum|floatformat:2 }}</td>
                        <td style="text-align: right;">{{ wallet_data.final_bal|floatformat:2 }}</td>

                {% endfor %}
                {% for total_ticker, total_data in totals.items %}
                    {% if total_ticker == ticker %}
                        <tr>
                            <td></td>
                            <td style="text-align: right; font-weight: bold;">TOTAL</td>
                            <td style="text-align: right; font-weight: bold;">{{ total_data.total_initial|floatformat:2 }}</td>
                            <td style="text-align: right; font-weight: bold;">{{ total_data.total_income|floatformat:2 }}</td>
                            <td style="text-align: right; font-weight: bold;">{{ total_data.total_spending|floatformat:2 }}</td>
                            <td style="text-align: right; font-weight: bold;">{{ total_data.total_final|floatformat:2 }}</td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}
{% endblock %}

{% block right_side %}
{% endblock %}

{% block diagram %}

    <div id="piechart" style="width: 500px; height: 500px;"></div>

{% endblock%}






