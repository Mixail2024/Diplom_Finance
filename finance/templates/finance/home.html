{% load static %}

<html>
    <head>
        <meta charset='UTF-8'>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel='stylesheet' type='text/css' href="{% static 'finance/style.css' %}">
        <title>Wallets</title>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">

            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);

            function drawChart() {

                var data1 = google.visualization.arrayToDataTable({{ data1|safe }});
                var options = {
                    title: 'My 3D Pie Chart',
                    is3D: true,
                    backgroundColor: { fill: 'transparent' },
                    slices: {
                        0: {offset: 0.1},         // Сдвиг первого сегмента
                        1: {offset: 0.1},         // Сдвиг второго сегмента
                    },
                    chartArea: {
                        left: 20,
                        top: 20,
                        width: '90%',
                        height: '80%'
                    },
                    pieSliceText: 'value',        // Отображение значений на диаграмме
                };

                var chart = new google.visualization.PieChart(document.getElementById('piechart'));
                chart.draw(data1, options);
            }
        </script>
    </head>
    <body>
        <div>
            <div class='nav_H'>
                <div class="wallet">Wallets</div>
                <button class="btn btn_add_wlt" onclick="location.href='{% url 'create_wlt' %}'">Add</button>
            </div>

            <form method='POST'>
            {% csrf_token %}
                <label>Period from</label> {{ form.init_date }}
                {% if form.date.errors %}
                    <div style="color: red;">{{ form.init_date.errors }}</div>
                {% endif %}
                <label>to</label> {{ form.final_date }}
                {% if form.date.errors %}
                    <div style="color: red;">{{ form.final_date.errors }}</div>
                {% endif %}


                 <!-- Подключение Flatpickr -->
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
                <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        flatpickr("#datepicker", {
                            dateFormat: "Y-m-d",
                        });
                    });
                </script>
                <button class='btn nav_btn' type='submit' >Set</button>
            </form>

            {% for wlt in wlts %}
                {% for i in data %}
                    {% if wlt.pk == i.wlt_pk %}
                        <p><button class="btn btn_wlts" onclick="location.href='{% url 'home_wlt' wlt.pk %}'">
                        <div style="font-weight: bold; margin: 0px 5px 5px 5px">{{wlt.f_name}}</div>
                        <span>init bal {{i.bal_on_date}}</span>
                        <br><span>turnover {{i.after_dt_sum}} / {{i.after_ct_sum}}</span>
                        <br><span>current bal {{i.final_bal}}</span>
                            {% if wlt.w_limit > 0 %}
                                <br><span>limit {{wlt.w_limit}}</span>
                            {% endif %}
                        </button></p>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>




        <div id="piechart" style="width: 450px; height: 250px; position: absolute; top: 80px; left: 200px; z-index: 1;"></div>
    </body>
</html>